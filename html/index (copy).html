<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Dolphin Live Stream</title>

    <script language="javascript">AC_FL_RunContent = 0;</script>
    <!-- Framework CSS -->
	<link rel="stylesheet" href="css/screen.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="css/wowza.css" type="text/css" />
	<script type="text/javascript" src="player/js/hdwplayer.js"></script>

        <style type="text/css">
            <!-- .Verdana {
                font-family: Verdana, Geneva, sans-serif;
            }
            -->
            </style>
</head>
<body>
    <div class="container">
		<!-- HEADER -->
        <div class="span-19">
            <h1>Dolphin Live Stream</h1><h2>A Project of PITB</h2>
        </div>
        <div class="span-2 last" >
            <a href="https://www.pitb.gov.pk/"><img src="img/pitb-logo.png" class="logo" style="height:90px;width:90px;float:right" /></a>
        </div>
        <hr class="heading">
		<!-- END HEADER -->
		<!-- EXAMPLE PLAYER: WIDTH of this player should be 630px, height will vary depending on the example-->
        <div class="span-21">
	    <table width="100%" border="0" cellspacing="5">
                <tr>
                    <td>
			    <div id="player"></div>
			    <script type="text/javascript">
			      hdwplayer({ 
				id        : 'player',
				swf       : 'player/player.swf?api=true',
				width     : '800',
				height    : '600',
				type      : 'rtmp',
				streamer  : 'rtmp://103.226.217.136:1935/live',
				video     : 'myStream',
				autoStart : 'false',
				controlBar: 'true'
				});
			    </script>
                    </td>
			
                </tr>
                <tr>
		    <td>
			
                <p>Stream Name&nbsp;<input id="strmName" maxlength="64" name="streamerName" size="32" type="text" value='rtmp://103.226.217.136:1935/live' />
			Video Name&nbsp;<input id="videoName" maxlength="16" name="videoName" size="16" type="text" value='myStream'/></p>

		<p><input name="connect" type="button" value="Get Status" onclick="webSock()" />
			<input name="golive" type="button" value="Go Live" onclick="SIGLive()" />
			<input name="golocal" type="button" value="Go Local" onclick="SIGLocal()" />
			<input name="gooff" type="button" value="Go Off" onclick="SIGOff()" /></p>

		<p id="demo"></p>
    </td>
			
                
                </tr>
            </table>
	        
		<!-- FOOTER -->
        <div class="span-24">
            <hr class="heading">
            <div class="span-1">
            	<img src="img/pitb-logo	.png" width="32" height="32" />
            </div>
            <div class="span-23 last copyright">
               	Â© 2013-2015 Punjab Information Technology Board
            </div>
        </div>
		<!-- END FOOTER -->
	</div>
	<script>
		var timer,actLive=false;
		function webSock() {
		  	ws=new WebSocket("ws://103.226.217.136:4446"); //103.226.217.136 //localhost
	
		  	ws.onerror=function(evt){
		  		document.getElementById("demo").innerHTML = 'Error opening WebSocket.';
		  	};
		  	ws.onmessage=function(evt){
				document.getElementById("demo").innerHTML = 'Received: '+evt.data;
				var rec = evt.data;
				if(rec == "ACK"){
					actLive=true;
					checkLive();
					return;
				}
				var json = JSON.parse(rec);
				if(json.status=="live"){
					actLive = false;
					hdwplayer({ 
						id        : 'player',
						swf       : 'player/player.swf?api=true',
						width     : '800',
						height    : '600',
						type      : 'rtmp',
						streamer  : document.getElementById("strmName").value,
						video     : json.streamId,
						autoStart : 'true',
						controlBar: 'true'
					});
					ws.close();
				}else if(actLive){
					SIGLive();
				}
			};
		  	ws.onopen=function(evt){
		    		document.getElementById("demo").innerHTML = 'Connection Successful.';
				ws.send("{\"streamId\":\"" +document.getElementById("videoName").value+ "\",\"action\":\"status\"}");
		  	};
		}
		function SIGLive() {
			ws.send("{\"streamId\":\""+document.getElementById("videoName").value+"\",\"action\":\"live\"}");
		}
		function SIGLocal() {
			ws=new WebSocket("ws://103.226.217.136:4446"); //103.226.217.136 //localhost
			ws.send("{\"streamId\":\""+document.getElementById("videoName").value+"\",\"action\":\"local\"}");
		}
		function SIGOff() {
			ws=new WebSocket("ws://103.226.217.136:4446"); //103.226.217.136 //localhost
			ws.send("{\"streamId\":\""+document.getElementById("videoName").value+"\",\"action\":\"off\"}");
		}
		window.onclose=function(){
			ws.close();
		}
		function checkLive() {
			ws.close();
			timer = setTimeout(webSock, 3000);
			//clearTimeout(timer);
			console.log("Check Live");
		}
	</script>
</body>
</html>
